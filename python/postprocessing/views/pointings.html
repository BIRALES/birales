<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Orbit determination input">
    <meta name="author" content="">

    <title>Orbit Determination | {{ observation }} - {{ data_set }}</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
          integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <style>
        td.od_value {
            font-size: 70%;
            margin-left: 40px;
            word-break: break-all;
        }
    </style>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Numeric JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
</head>
<body>

<div class="container">
    <div class="page-header">
        <h1>Multi-Beam</h1>
        <h2>Observation <b>{{ observation }}</b> and data set <b>{{ data_set }}</b></h2>
        <!--<h2>-->
        <!--<small>Showing all beam data</small>-->
        <!--</h2>-->
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div id="plots"></div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-2.2.3.min.js"
        integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="
        crossorigin="anonymous">
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
        integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
        crossorigin="anonymous">
</script>


<script>
    $(document).ready(function () {
        var data_url = "{{request.url_root}}birales/api/pointings/{{observation}}/{{data_set}}";

        $.ajax({
            url: data_url,
            success: function (pointings) {
                var reference = pointings['reference'];
                var beam_pointings = pointings['beams'];
                var shapes = [];
                var data = [{
                    x: [],
                    y: [],
                    text: [],
                    mode: 'text'
                }];
                $(beam_pointings).each(function (beam_id, pointing_data) {
                    ra = pointing_data[0];
                    dec = pointing_data[1];
                    bw_ra = 1.75;
                    bw_dec = 0.5;

                    shape = {
                        type: 'circle',
                        xref: 'x',
                        yref: 'y',
                        x0: reference[0] + ra,
                        x1: reference[0] + ra + bw_ra,
                        y0: reference[1] + dec,
                        y1: reference[1] + dec + bw_dec,
                        line: {
                            color: 'rgba(50, 171, 96, 1)'
                        }
                    };
                    data[0].x.push(reference[0] + ra + (bw_ra * 0.5));
                    data[0].y.push(reference[1] + dec + (bw_dec * 0.5));
                    data[0].text.push(beam_id);

                    shapes.push(shape);
                });

                var layout = {
                    title: 'MultiBeam',
                    xaxis: {
                        autorange: true,
                        title: 'ra (deg)'
                    },
                    yaxis: {
                        autorange: true,
                        title: 'dec (deg)'
                    },
                    width: 500,
                    height: 500,
                    shapes: shapes
                };

                Plotly.newPlot('plots', data, layout);
            }
        });
    });

</script>
</body>
</html>