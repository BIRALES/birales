; Settings to change (if required) for new observations:
; - receiver.start_time (if roach was re-programmed, this is the time in unix standard time read from the roach)
; - observation.name (Name of the observation)
; - observation.transmitter_frequency
; - beamformer.reference_pointing
; - persister.filename and persister.directory
; - correlator.integration (if correlating)
; - corrmatrixpersister.filename and corrmatrixpersister.directory (if correlating)


[observation]
transmitter_frequency = 410.07
start_center_frequency = 410.109375
channel_bandwidth = 0.078125
samples_per_second = 78125
name = casa
duration = None
id = False

[manager]
enable_plotting = True
plot_update_rate = 3
loggging_config_file_path = configuration/logging.ini
profile = False
profiler_file_path = /var/log/birales/profiling
profile_timeit = False
detector_enabled=True
offline = True
save_raw = False
save_beam = False

[instrument]
enable_pointing = False


; --------------------------------------------- Modules ------------------------------------------------

; ---------------- Generator ---------------------

[generator]
; Used for testing purposes only
nsamp = 262144
nants = 32
nsubs = 1
complex = True
nbits = 64
npols = 1

; ---------------- Correlator ---------------------

[correlator]
; Number of integrations (131072 == 1.6777s)
integrations = 131072

; ---------------- Receiver ---------------------

[receiver]
; Receiver settings, do not change except for start_time)
backend_config_filepath =  backend/roach_backend.ini
start_time = 1496332160
daq_file_path = /opt/aavs/lib/libaavsdaq.so
nsamp = 262144
nants = 32
nsubs = 1
nbits = 64
npols = 1
complex = True
port = 7200
interface = eth3
ip = 192.168.11.11
frame_size = 9000
frames_per_block = 32
nblocks = 256

[rawdatareader]
; Used for offline processing of raw data
<<<<<<< Updated upstream
filepath = /mnt/2017/21_11_2017/casa/casa_raw.dat
config_ext = .pkl
nsamp = 262144
nants = 32
npols = 1
nsubs = 1

; ---------------- Beamformer ---------------------

[beamformer]

nthreads = 8

; Reference declination
reference_declination = 58.917

; Pointing difference from reference pointing in [HourAngle, deltaDEC]
nbeams = 32
pointings = [                                     [-3.2,-0.5],             [-3.2,0.5],
            [-1.6,-2],  [-1.6,-1.5],  [-1.6,-1],  [-1.6,-0.5],  [-1.6,0],  [-1.6,0.5],  [-1.6,1],  [-1.6,1.5],  [-1.6,2],
            [0,-2],     [0,-1.5],     [0,-1],    [0,-0.5],     [0,0],     [0,0.5],     [0,1],     [0,1.5],     [0,2],
            [1.6,-2],   [1.6,-1.5],   [1.6,-1],   [1.6,-0.5],   [1.6,0],   [1.6,0.5],   [1.6,1],   [1.6,1.5],   [1.6,2],
            [3.2,-0.5],   [3.2,0],   [3.2,0.5]]

;nbeams = 1
;pointings = [[0, 0]]

; Antenna position difference from reference in meters [x, y, h]
reference_antenna_location = [11.6459889, 44.52357778]

; Select antennas to disable
disable_antennas = []

antenna_locations = [[0,      0,  0],
                    [5.6665, 0,  0],
                    [11.333, 0,  0],
                    [16.999, 0,  0],
                    [0,      10, 0],
                    [5.6665, 10, 0],
                    [11.333, 10, 0],
                    [16.999, 10, 0],
                    [0,      20, 0],
                    [5.6665, 20, 0],
                    [11.333, 20, 0],
                    [16.999, 20, 0],
                    [0,      30, 0],
                    [5.6665, 30, 0],
                    [11.333, 30, 0],
                    [16.999, 30, 0],
                    [0,      40, 0],
                    [5.6665, 40, 0],
                    [11.333, 40, 0],
                    [16.999, 40, 0],
                    [0,      50, 0],
                    [5.6665, 50, 0],
                    [11.333, 50, 0],
                    [16.999, 50, 0],
                    [0,      60, 0],
                    [5.6665, 60, 0],
                    [11.333, 60, 0],
                    [16.999, 60, 0],
                    [0,      70, 0],
                    [5.6665, 70, 0],
                    [11.333, 70, 0],
                    [16.999, 70, 0]]

; ---------------- Channelsier ---------------------

[channeliser]
nchans = 8192
ntaps = 8
nthreads = 4
use_numba = False

; ---------------- Persisters ---------------------
[persisters]
; Where to persist the raw/beam data
directory = .

[corrmatrixpersister]
; Saves correlation matrices to file
filename_suffix = _corr
use_timestamp = False

[persister]
; Saves beamformed data to file
filename_suffix = _beam
use_timestamp = False

[rawpersister]
; Saves raw data to file
filename_suffix = _raw
use_timestamp = False

; ---------------- Detector ---------------------
[detection]
visualise_fits_dir = .birales/fits
visualise_beams = []
save_candidates = True
debug_candidates = True
beam_range = [0,32]
multi_proc = True
n_procs = 12
select_highest_snr = True

n_noise_samples = 5
noise_channels = [5000, 8191]
noise_use_rms = True

m_limit = [-15000.0, 15000.0]
doppler_range = [-12143, 13245]
doppler_subset = False

[monitoring]
visualize_beams = []
file_path = public
save_filtered_beam_data = False
image_ext = png

[database]
authentication = False
name = birales
host = localhost
port = 27017
user = birales_rw
password = arcadia10

; --------------------------------------------- Modules ------------------------------------------------



; --------------- Terminator -------------------

[terminator]


; --------------------------------------------- Plotters ------------------------------------------------

[beamplotter]
beam_range = 15
nof_samples = 2048

[channelplotter]
beam_range = 0
; channel_range = [256, 511]
nof_samples = 1024

[antennaplotter]
antenna_range = [1,2]
nof_samples = 4096

[bandpassplotter]
beam_range = [4, 5]
; channel_range = [257, 511]
nof_samples = 1024

; Flask configuration
[flask]
debug = true
secret_key = secret!
host = 0.0.0.0
port = 8000


; Logging Configuration
[loggers]
keys = root

[handlers]
keys = stream_handler

[formatters]
keys = formatter

[logger_root]
level = DEBUG
handlers = stream_handler
propagate = 0

[handler_stream_handler]
class = StreamHandler
formatter = formatter
args = (sys.stderr,)

[handler_rot_handler]
log_directory = /var/log/birales
class=logging.handlers.TimedRotatingFileHandler
formatter=formatter
args = ()

[formatter_formatter]
format = %(asctime)s %(levelname)-8s %(process)-5s %(processName)-15s %(threadName)-15s %(message)s

[calibration]
real_vis_dir = /tmp/tcpo/
real_vis_file = Virgo_corr.h5
calibration_dec = 58.917
model_generation = False
selfcal = True
stefcal = False
transit_run = True
coeff_test = True
auto_corr = False
t_average = 1.667
t_step_length = 1.667
obs_length = 1
start_time = 1
